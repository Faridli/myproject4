{% extends "dashboard/css.html" %}
{% load widget_tweaks %}

{% block title %}RO Office{% endblock %}

{% block content %}
<main class="p-6 bg-white rounded-xl shadow-md max-w-3xl mx-auto">

    <h1 class="bg-amber-500 text-4xl font-bold mb-6 text-center text-gray-900 rounded py-4">RO Entry</h1>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Per Number -->
        <div class="flex items-center mb-4">
            <label class="w-40 font-semibold text-lg text-gray-800">Per Number</label>
            <input type="text" id="id_per_number" 
                   class="flex-1 border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- NID -->
        <div class="flex items-center mb-4">
            <label class="w-40 font-semibold text-lg text-gray-800">NID</label>
            <input type="text" id="id_nid" 
                   class="flex-1 border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Rank -->
        <div class="flex items-center mb-4">
            <label class="w-40 font-semibold text-lg text-gray-800">Rank</label>
            <input type="text" id="rank" class="flex-1 border border-gray-300 rounded px-3 py-2 bg-gray-100" readonly>
        </div>

        <!-- Name -->
        <div class="flex items-center mb-4">
            <label class="w-40 font-semibold text-lg text-gray-800">Name</label>
            <input type="text" id="name" class="flex-1 border border-gray-300 rounded px-3 py-2 bg-gray-100" readonly>
        </div>

        <!-- Destination -->
        <div class="flex items-center mb-4">
            <label class="w-40 font-semibold text-lg text-gray-800">Destination</label>
            {{ form.destination|add_class:"flex-1 border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500"|attr:"id:id_destination" }}
        </div>

        <!-- Signature -->
        <div class="flex items-center mb-4">
            <label class="w-40 font-semibold text-lg text-gray-800">Signature</label>
            {{ form.sing|add_class:"flex-1 border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500"|attr:"id:id_signature" }}
        </div>

        <div class="text-center">
            <button class="bg-blue-600 text-white text-2xl px-6 py-2 rounded hover:bg-blue-700 transition-colors">
                Save
            </button>
        </div>
    </form>
</main>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    const perNumberField = document.getElementById("id_per_number");
    const nidField = document.getElementById("id_nid");
    const rankField = document.getElementById("rank");
    const nameField = document.getElementById("name");

    function fetchMember(value) {
        if (!value) {
            rankField.value = "";
            nameField.value = "";
            return;
        }

        fetch(`/tasks/member-get/${encodeURIComponent(value)}/`)
            .then(response => response.json())
            .then(data => {
                rankField.value = data.success ? data.rank : "";
                nameField.value = data.success ? data.name : "";
            })
            .catch(err => console.error("Error fetching data:", err));
    }

    perNumberField.addEventListener("input", () => fetchMember(perNumberField.value.trim()));
    nidField.addEventListener("input", () => fetchMember(nidField.value.trim()));
});

</script>
{% endblock %}
